
from .utils import Utils # type: ignore


class BulkSMS:
    def __init__(self, sdp):
        """
        Subscription constructor.
        
        :param sdp: Instance of the SDP class
        """
        self.SDP = sdp

    def send_sms(self, request_id, username, package_id, originating_address, recipients, message, callback):
        """
        Send Bulk SMS to a group of users.
        
        :param request_id: Transaction id generated by client for tracking purposes (alphanumeric)
        :param username: Username allocated by the SDP to the partner after successful registration
        :param package_id: The id of the campaign package as issued upon successful registration
        :param originating_address: Originating address assigned to partner after successful registration
        :param recipients: The list of phone numbers to send the request to. Format is 7.... (no '0' and no country code)
        :param message: Content of the SMS to be sent to user
        :param callback: URL of the CP App for receiving status report
        :return: dict
        """

        body = {
            "timeStamp": self.SDP.generate_timestamp(),
            "dataSet": [
                {
                    "userName": username,
                    "channel": "sms",
                    "packageId": package_id,
                    "oa": originating_address,
                    "msisdn": ",".join(recipients),
                    "message": message,
                    "uniqueId": request_id,
                    "actionResponseURL": callback
                }
            ]
        }

        response = self.SDP.request.request("post", "public/CMS/bulksms", self.SDP.token, body)
                
        return Utils.get_response(response)
