
from .utils import Utils


class Subscription:
    """
    Subscription class for Safaricom SDP integration.
    """

    def __init__(self, sdp):
        """
        Subscription constructor.

        :param sdp: An instance of the SDP class
        """
        self.SDP = sdp

    def activate_subscription(self, request_id, offer_code, phone_number):
        """
        Activate subscription of a user to a given offer code.

        :param request_id: Transaction ID generated by the client for tracking purposes
        :param offer_code: Offer code allocated by the partner or Safaricom on successful service creation from SDP
        :param phone_number: Phone number of the user to be activated
        :return: Response as a dictionary
        """
        body = {
            "requestId": request_id,
            "requestTimeStamp": self.SDP.generate_timestamp(),
            "Channel": "SMS",
            "Operation": "ACTIVATE",
            "requestParam": {
                "data": [
                    {"name": "OfferCode", "value": offer_code},
                    {"name": "Msisdn", "value": phone_number},
                    {"name": "Language", "value": "1"},
                    {"name": "CpId", "value": self.SDP.cp_id}
                ]
            }
        }

        response = self.SDP.request.request("post", "public/SDP/activate", self.SDP.token, body)
        return Utils.get_response(response)

    def deactivate_subscription(self, request_id, offer_code, phone_number):
        """
        Unsubscribe a user from an offer code.

        :param request_id: Transaction ID generated by the client for tracking purposes
        :param offer_code: Offer code allocated by the partner or Safaricom on successful service creation from SDP
        :param phone_number: Phone number of the user to be unsubscribed
        :return: Response as a dictionary
        """
        body = {
            "requestId": request_id,
            "requestTimeStamp": self.SDP.generate_timestamp(),
            "channel": "3",
            "operation": "DEACTIVATE",
            "requestParam": {
                "data": [
                    {"name": "OfferCode", "value": offer_code},
                    {"name": "Msisdn", "value": phone_number},
                    {"name": "CpId", "value": self.SDP.cp_id}
                ]
            }
        }

        response = self.SDP.request.request("post", "public/SDP/deactivate", self.SDP.token, body)
        return Utils.get_response(response)
